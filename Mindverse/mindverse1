import React, { useState, useEffect, useRef } from 'react';
import { Heart, Cloud, Sun, CloudRain, Wind, Zap, Leaf, Brain, Play, Pause, Volume2, VolumeX, LogOut, User, TrendingUp, Award, Target, X, AlertCircle } from 'lucide-react';

// Weather themes based on emotions
const weatherThemes = {
  anxious: {
    name: 'Stormy',
    icon: CloudRain,
    gradient: 'from-gray-700 via-gray-600 to-blue-900',
    particle: 'ğŸŒ§ï¸',
    sound: 'rain',
    color: '#60a5fa'
  },
  stressed: {
    name: 'Cloudy',
    icon: Cloud,
    gradient: 'from-slate-600 via-slate-500 to-slate-400',
    particle: 'â˜ï¸',
    sound: 'wind',
    color: '#94a3b8'
  },
  sad: {
    name: 'Overcast',
    icon: Cloud,
    gradient: 'from-indigo-900 via-blue-800 to-slate-700',
    particle: 'ğŸ’§',
    sound: 'ambient',
    color: '#818cf8'
  },
  calm: {
    name: 'Clear',
    icon: Sun,
    gradient: 'from-blue-400 via-cyan-300 to-teal-200',
    particle: 'âœ¨',
    sound: 'nature',
    color: '#06b6d4'
  },
  happy: {
    name: 'Sunny',
    icon: Sun,
    gradient: 'from-yellow-400 via-orange-300 to-pink-400',
    particle: 'â˜€ï¸',
    sound: 'uplifting',
    color: '#fbbf24'
  },
  tired: {
    name: 'Twilight',
    icon: Cloud,
    gradient: 'from-purple-900 via-indigo-800 to-blue-900',
    particle: 'ğŸŒ™',
    sound: 'calm',
    color: '#a78bfa'
  }
};

// Calming audio using Web Audio API (always works, no external URLs needed)
const musicTracks = {
  rain: {
    name: 'ğŸŒ§ï¸ Rain Rhythm',
    type: 'generated',
    emoji: 'ğŸŒ§ï¸',
    description: 'For anxiety & overthinking'
  },
  nature: {
    name: 'ğŸŒ¿ Forest Breath',
    type: 'generated',
    emoji: 'ğŸŒ¿',
    description: 'For mental fatigue & burnout'
  },
  ocean: {
    name: 'ğŸŒŠ Ocean Waves',
    type: 'generated',
    emoji: 'ğŸŒŠ',
    description: 'For deep reset'
  },
  wind: {
    name: 'ğŸ’¨ Meditation Flow',
    type: 'generated',
    emoji: 'ğŸ’¨',
    description: 'Breathing & meditation'
  },
  ambient: {
    name: 'ğŸµ Deep Peace',
    type: 'generated',
    emoji: 'ğŸµ',
    description: 'Deep peace & calm'
  },
  calm: {
    name: 'ğŸ§˜ Inner Peace',
    type: 'generated',
    emoji: 'ğŸ§˜',
    description: 'Mindfulness & yoga'
  },
  uplifting: {
    name: 'â˜€ï¸ Gentle Dawn',
    type: 'generated',
    emoji: 'â˜€ï¸',
    description: 'Focus & positive mood'
  },
  silence: {
    name: 'ğŸ”‡ Silence',
    type: 'none',
    emoji: 'ğŸ”‡',
    description: 'No sound'
  }
};

// Sound patterns for each mood
const soundPatterns = {
  rain: {
    frequencies: [220, 246.94, 196, 174.61],
    durations: [0.8, 0.6, 1.2, 1.5],
    waveType: 'sine',
    volume: 0.32,
    tempo: 1.8
  },
  nature: {
    frequencies: [164.81, 196, 164.81, 130.81],
    durations: [2.5, 2.5, 2.5, 4.0],
    waveType: 'triangle',
    volume: 0.24,
    tempo: 3.0
  },
  ocean: {
    frequencies: [110, 123.47, 146.83, 123.47, 110, 98],
    durations: [3.0, 2.5, 2.0, 2.5, 3.5, 4.0],
    waveType: 'sine',
    volume: 0.28,
    tempo: 2.8
  },
  wind: {
    frequencies: [246.94, 220, 196, 220, 196, 174.61, 146.83],
    durations: [1.0, 0.8, 1.2, 0.8, 1.0, 1.5, 2.0],
    waveType: 'triangle',
    volume: 0.24,
    tempo: 1.5
  },
  ambient: {
    frequencies: [87.31, 98, 110, 98],
    durations: [4.0, 4.0, 4.0, 5.0],
    waveType: 'sine',
    volume: 0.20,
    tempo: 3.5
  },
  calm: {
    frequencies: [130.81, 146.83, 164.81, 174.61, 164.81, 146.83, 130.81],
    durations: [2.5, 2.0, 2.5, 2.0, 2.5, 2.0, 3.5],
    waveType: 'triangle',
    volume: 0.24,
    tempo: 2.5
  },
  uplifting: {
    frequencies: [196, 220, 246.94, 261.63, 293.66, 261.63, 246.94, 220],
    durations: [1.2, 1.2, 1.2, 1.5, 1.5, 1.2, 1.2, 2.0],
    waveType: 'triangle',
    volume: 0.28,
    tempo: 1.8
  }
};

const soundOptions = [
  { id: 'rain', name: 'ğŸŒ§ï¸ Rain', emoji: 'ğŸŒ§ï¸' },
  { id: 'nature', name: 'ğŸŒ¿ Nature', emoji: 'ğŸŒ¿' },
  { id: 'ocean', name: 'ğŸŒŠ Ocean', emoji: 'ğŸŒŠ' },
  { id: 'wind', name: 'ğŸ’¨ Wind', emoji: 'ğŸ’¨' },
  { id: 'ambient', name: 'ğŸµ Ambient', emoji: 'ğŸµ' },
  { id: 'calm', name: 'ğŸ§˜ Calm', emoji: 'ğŸ§˜' },
  { id: 'uplifting', name: 'â˜€ï¸ Uplifting', emoji: 'â˜€ï¸' },
  { id: 'silence', name: 'ğŸ”‡ Silence', emoji: 'ğŸ”‡' }
];

// Support message options
const supportMessages = [
  {
    id: 'love',
    emoji: 'â¤ï¸',
    title: 'Love',
    message: 'Sending you love and warmth',
    color: 'from-red-400 to-pink-500',
    icon: 'â¤ï¸'
  },
  {
    id: 'strength',
    emoji: 'ğŸ’ª',
    title: 'Strength',
    message: 'You are stronger than you think',
    color: 'from-orange-400 to-red-500',
    icon: 'ğŸ’ª'
  },
  {
    id: 'hope',
    emoji: 'ğŸŒŸ',
    title: 'Hope',
    message: 'Better days are coming',
    color: 'from-yellow-400 to-orange-500',
    icon: 'ğŸŒŸ'
  },
  {
    id: 'peace',
    emoji: 'â˜®ï¸',
    title: 'Peace',
    message: 'May you find inner peace',
    color: 'from-blue-400 to-cyan-500',
    icon: 'â˜®ï¸'
  },
  {
    id: 'courage',
    emoji: 'ğŸ¦',
    title: 'Courage',
    message: 'You have the courage to overcome',
    color: 'from-purple-400 to-pink-500',
    icon: 'ğŸ¦'
  },
  {
    id: 'calm',
    emoji: 'ğŸ•Šï¸',
    title: 'Calm',
    message: 'Breathe, you are not alone',
    color: 'from-teal-400 to-blue-500',
    icon: 'ğŸ•Šï¸'
  }
];

export default function MindVerse() {
  // Auth state
  const [isLoggedIn, setIsLoggedIn] = useState(false);
  const [username, setUsername] = useState('');
  const [email, setEmail] = useState('');
  const [loginInput, setLoginInput] = useState('');
  const [emailInput, setEmailInput] = useState('');
  const [loginError, setLoginError] = useState('');
  
  // Load saved username and email on mount
  useEffect(() => {
    const savedUsername = localStorage.getItem('mindverse_username');
    const savedEmail = localStorage.getItem('mindverse_email');
    if (savedUsername && savedEmail) {
      setUsername(savedUsername);
      setEmail(savedEmail);
      setIsLoggedIn(true);
      setStage('welcome');
    }
  }, []);
  
  // Save username and email whenever they change
  useEffect(() => {
    if (username && email) {
      localStorage.setItem('mindverse_username', username);
      localStorage.setItem('mindverse_email', email);
    }
  }, [username, email]);
  
  // Core states
  const [currentMood, setCurrentMood] = useState(null);
  const [currentTheme, setCurrentTheme] = useState(weatherThemes.calm);
  const [stage, setStage] = useState('welcome'); // welcome, moodSelect, dashboard, reset, reframe, journal
  
  // Gamification - stored per user
  const [energyPoints, setEnergyPoints] = useState(0);
  const [calmPoints, setCalmPoints] = useState(0);
  const [plantLevel, setPlantLevel] = useState(1);
  const [dailyStreak, setDailyStreak] = useState(0);
  
  // Load user's progress when they log in
  useEffect(() => {
    if (isLoggedIn && username) {
      const userProgressKey = `progress_${username}`;
      const savedProgress = localStorage.getItem(userProgressKey);
      if (savedProgress) {
        try {
          const progress = JSON.parse(savedProgress);
          setEnergyPoints(progress.energyPoints || 0);
          setCalmPoints(progress.calmPoints || 0);
          setPlantLevel(progress.plantLevel || 1);
          setDailyStreak(progress.dailyStreak || 0);
        } catch (error) {
          console.error('Error loading progress:', error);
        }
      }
    }
  }, [isLoggedIn, username]);
  
  // Save progress whenever it changes
  useEffect(() => {
    if (isLoggedIn && username) {
      const userProgressKey = `progress_${username}`;
      const progress = {
        energyPoints,
        calmPoints,
        plantLevel,
        dailyStreak
      };
      localStorage.setItem(userProgressKey, JSON.stringify(progress));
    }
  }, [energyPoints, calmPoints, plantLevel, dailyStreak, isLoggedIn, username]);
  
  // Activity states
  const [breathingActive, setBreathingActive] = useState(false);
  const [breathPhase, setBreathPhase] = useState('inhale');
  const [breathCount, setBreathCount] = useState(0);
  const [soundEnabled, setSoundEnabled] = useState(false);
  const [selectedSound, setSelectedSound] = useState('calm');
  const audioContextRef = useRef(null);
  const currentSoundRef = useRef(null);
  const isPlayingRef = useRef(false);
  
  // Play a calming tone
  const playTone = async (frequency, duration, pattern) => {
    if (!audioContextRef.current || !isPlayingRef.current) return;
    
    return new Promise((resolve) => {
      const ctx = audioContextRef.current;
      const oscillator = ctx.createOscillator();
      const gainNode = ctx.createGain();
      
      oscillator.type = pattern.waveType;
      oscillator.frequency.value = frequency;
      
      const now = ctx.currentTime;
      gainNode.gain.setValueAtTime(0, now);
      gainNode.gain.linearRampToValueAtTime(pattern.volume, now + 0.3);
      gainNode.gain.linearRampToValueAtTime(pattern.volume * 0.8, now + 0.5);
      gainNode.gain.exponentialRampToValueAtTime(0.01, now + duration - 0.1);
      gainNode.gain.linearRampToValueAtTime(0.001, now + duration);
      
      oscillator.connect(gainNode);
      gainNode.connect(ctx.destination);
      
      oscillator.start(now);
      oscillator.stop(now + duration);
      
      setTimeout(resolve, duration * 1000);
    });
  };
  
  // Play sound pattern
  const playSoundPattern = async (soundType) => {
    if (soundType === 'silence' || !soundEnabled) {
      isPlayingRef.current = false;
      return;
    }
    
    const pattern = soundPatterns[soundType];
    if (!pattern) return;
    
    if (!audioContextRef.current) {
      audioContextRef.current = new (window.AudioContext || window.webkitAudioContext)();
    }
    
    isPlayingRef.current = true;
    currentSoundRef.current = soundType;
    
    console.log(`ğŸµ Playing: ${musicTracks[soundType].name}`);
    
    // Play all tones in sequence
    for (let i = 0; i < pattern.frequencies.length; i++) {
      if (!isPlayingRef.current || currentSoundRef.current !== soundType) break;
      
      await playTone(
        pattern.frequencies[i],
        pattern.durations[i] * pattern.tempo,
        pattern
      );
    }
    
    // Loop if still playing the same sound
    if (isPlayingRef.current && currentSoundRef.current === soundType && soundEnabled) {
      setTimeout(() => playSoundPattern(soundType), 1500);
    }
  };
  
  // Stop all sounds
  const stopAllSounds = () => {
    console.log('ğŸ›‘ Stopping sounds');
    isPlayingRef.current = false;
    currentSoundRef.current = null;
    
    if (audioContextRef.current && audioContextRef.current.state !== 'closed') {
      // Suspend context to stop all audio
      audioContextRef.current.suspend();
    }
  };
  
  // Handle sound changes
  useEffect(() => {
    stopAllSounds();
    
    if (soundEnabled && selectedSound !== 'silence') {
      // Resume or create audio context
      if (audioContextRef.current && audioContextRef.current.state === 'suspended') {
        audioContextRef.current.resume();
      }
      
      setTimeout(() => {
        playSoundPattern(selectedSound);
      }, 100);
    }
    
    return () => {
      stopAllSounds();
    };
  }, [soundEnabled, selectedSound]);
  const [thoughtInput, setThoughtInput] = useState('');
  const [reframedThought, setReframedThought] = useState('');
  const [isReframing, setIsReframing] = useState(false);
  
  // Journal - persisted per user
  const [journalEntry, setJournalEntry] = useState('');
  const [journalEntries, setJournalEntries] = useState([]);
  
  // Stress detection
  const [typingSpeed, setTypingSpeed] = useState(0);
  const [lastKeyTime, setLastKeyTime] = useState(Date.now());
  const [keyPressCount, setKeyPressCount] = useState(0);
  
  // Live map - with dynamic randomization
  const [globalMood, setGlobalMood] = useState({
    stressed: 56,
    calm: 34,
    happy: 42,
    sad: 23,
    anxious: 31,
    tired: 19
  });
  
  // Randomize global mood counts when component mounts or stage changes to dashboard
  useEffect(() => {
    if (stage === 'dashboard') {
      setGlobalMood(prev => {
        const randomChange = () => {
          // Randomly decide to increase or decrease
          const direction = Math.random() > 0.5 ? 1 : -1;
          // Random amount between 1-3
          const amount = Math.floor(Math.random() * 3) + 1;
          return direction * amount;
        };
        
        return {
          stressed: Math.max(20, Math.min(95, prev.stressed + randomChange())),
          calm: Math.max(20, Math.min(85, prev.calm + randomChange())),
          happy: Math.max(25, Math.min(90, prev.happy + randomChange())),
          sad: Math.max(15, Math.min(70, prev.sad + randomChange())),
          anxious: Math.max(18, Math.min(85, prev.anxious + randomChange())),
          tired: Math.max(12, Math.min(75, prev.tired + randomChange()))
        };
      });
    }
  }, [stage]);
  
  // Also update counts every 30 seconds while on dashboard
  useEffect(() => {
    if (stage === 'dashboard') {
      const interval = setInterval(() => {
        setGlobalMood(prev => {
          const smallChange = () => {
            // Randomly decide to increase or decrease
            const direction = Math.random() > 0.5 ? 1 : -1;
            // Random amount between 1-3
            const amount = Math.floor(Math.random() * 3) + 1;
            return direction * amount;
          };
          
          return {
            stressed: Math.max(20, Math.min(95, prev.stressed + smallChange())),
            calm: Math.max(20, Math.min(85, prev.calm + smallChange())),
            happy: Math.max(25, Math.min(90, prev.happy + smallChange())),
            sad: Math.max(15, Math.min(70, prev.sad + smallChange())),
            anxious: Math.max(18, Math.min(85, prev.anxious + smallChange())),
            tired: Math.max(12, Math.min(75, prev.tired + smallChange()))
          };
        });
      }, 30000); // Update every 30 seconds
      
      return () => clearInterval(interval);
    }
  }, [stage]);
  
  // Mood history - stored per user
  const [moodHistory, setMoodHistory] = useState([]);
  
  // Load user's mood history when they log in
  useEffect(() => {
    if (isLoggedIn && username) {
      const userMoodKey = `moodHistory_${username}`;
      const savedMoodHistory = localStorage.getItem(userMoodKey);
      if (savedMoodHistory) {
        try {
          setMoodHistory(JSON.parse(savedMoodHistory));
        } catch (error) {
          console.error('Error loading mood history:', error);
          setMoodHistory([]);
        }
      }
    }
  }, [isLoggedIn, username]);
  
  // Save mood history whenever it changes
  useEffect(() => {
    if (isLoggedIn && username && moodHistory.length > 0) {
      const userMoodKey = `moodHistory_${username}`;
      localStorage.setItem(userMoodKey, JSON.stringify(moodHistory));
    }
  }, [moodHistory, isLoggedIn, username]);
  
  // Load user's journal entries when they log in
  useEffect(() => {
    if (isLoggedIn && username) {
      const userJournalKey = `journalEntries_${username}`;
      const savedJournalEntries = localStorage.getItem(userJournalKey);
      if (savedJournalEntries) {
        try {
          setJournalEntries(JSON.parse(savedJournalEntries));
        } catch (error) {
          console.error('Error loading journal entries:', error);
          setJournalEntries([]);
        }
      } else {
        setJournalEntries([]);
      }
    }
  }, [isLoggedIn, username]);
  
  // Save journal entries whenever they change
  useEffect(() => {
    if (isLoggedIn && username && journalEntries.length > 0) {
      const userJournalKey = `journalEntries_${username}`;
      localStorage.setItem(userJournalKey, JSON.stringify(journalEntries));
    }
  }, [journalEntries, isLoggedIn, username]);
  
  // Self-care tasks - stored per user per day
  const [completedTasks, setCompletedTasks] = useState([]);
  const [showTasks, setShowTasks] = useState(false);
  
  // Load user's completed tasks for today
  useEffect(() => {
    if (isLoggedIn && username) {
      const today = new Date().toDateString();
      const userTasksKey = `tasks_${username}_${today}`;
      const savedTasks = localStorage.getItem(userTasksKey);
      if (savedTasks) {
        try {
          setCompletedTasks(JSON.parse(savedTasks));
        } catch (error) {
          console.error('Error loading tasks:', error);
          setCompletedTasks([]);
        }
      } else {
        setCompletedTasks([]);
      }
    }
  }, [isLoggedIn, username]);
  
  // Save completed tasks whenever they change
  useEffect(() => {
    if (isLoggedIn && username && completedTasks.length > 0) {
      const today = new Date().toDateString();
      const userTasksKey = `tasks_${username}_${today}`;
      localStorage.setItem(userTasksKey, JSON.stringify(completedTasks));
    }
  }, [completedTasks, isLoggedIn, username]);
  
  // Support message selection
  const [showSupportModal, setShowSupportModal] = useState(false);
  const [selectedSupport, setSelectedSupport] = useState(null);
  const [showSupportNotification, setShowSupportNotification] = useState(false);
  const [sentSupportMessage, setSentSupportMessage] = useState(null);
  
  // Received support messages
  const [showReceivedSupport, setShowReceivedSupport] = useState(false);
  const [receivedSupportMessage, setReceivedSupportMessage] = useState(null);
  
  // Personalized task recommendation
  const [showTaskRecommendation, setShowTaskRecommendation] = useState(false);
  const [recommendedTask, setRecommendedTask] = useState(null);
  const [lastActivityTime, setLastActivityTime] = useState(Date.now());
  const [activityLog, setActivityLog] = useState({
    breathingCount: 0,
    reframeCount: 0,
    journalCount: 0,
    tasksCompleted: 0,
    timeOnDashboard: 0,
    stressDetected: false,
    lastInteractionTime: Date.now()
  });
  
  // Track previous recommendations to avoid repeats
  const [previousRecommendations, setPreviousRecommendations] = useState([]);
  
  // Track if recommendation has been shown this session (ONE TIME ONLY)
  const [hasShownRecommendation, setHasShownRecommendation] = useState(false);
  
  // Check if recommendation was already shown in this session on mount
  useEffect(() => {
    if (isLoggedIn && username) {
      const sessionKey = `recommendation_shown_${username}_${Date.now()}`;
      const storedSessionKey = sessionStorage.getItem('mindverse_current_session');
      const hasShownInSession = sessionStorage.getItem('mindverse_recommendation_shown');
      
      if (!storedSessionKey) {
        // New session - create session ID
        sessionStorage.setItem('mindverse_current_session', sessionKey);
        sessionStorage.removeItem('mindverse_recommendation_shown');
      } else if (hasShownInSession === 'true') {
        // Already shown in this session
        setHasShownRecommendation(true);
        console.log('ğŸ”’ Recommendation already shown in this session');
      }
    }
  }, [isLoggedIn, username]);
  
  // Self-care task categories
  const selfCareTasks = {
    physical: [
      { id: 'p1', task: 'ğŸ’§ Drink a glass of water', points: 3, calm: 2, category: 'hydration' },
      { id: 'p2', task: 'ğŸš¶ Take a 5-minute walk', points: 8, calm: 10, category: 'movement' },
      { id: 'p3', task: 'ğŸ§˜ Stretch for 3 minutes', points: 6, calm: 8, category: 'movement' },
      { id: 'p4', task: 'ğŸ Eat a healthy snack', points: 5, calm: 3, category: 'nutrition' },
      { id: 'p5', task: 'ğŸ’¤ Take a 10-minute power nap', points: 10, calm: 15, category: 'rest' },
      { id: 'p6', task: 'ğŸƒ Do 10 jumping jacks', points: 7, calm: 5, category: 'movement' },
      { id: 'p7', task: 'ğŸ§Š Splash cold water on your face', points: 4, calm: 6, category: 'refresh' },
      { id: 'p8', task: 'ğŸŒ Step outside for fresh air', points: 8, calm: 12, category: 'environment' }
    ],
    mental: [
      { id: 'm1', task: 'ğŸ“– Read for 10 minutes', points: 10, calm: 12, category: 'mindfulness' },
      { id: 'm2', task: 'ğŸµ Listen to your favorite song', points: 6, calm: 8, category: 'relaxation' },
      { id: 'm3', task: 'ğŸ¨ Doodle or color for 5 minutes', points: 8, calm: 10, category: 'creative' },
      { id: 'm4', task: 'ğŸ§© Solve a quick puzzle', points: 7, calm: 6, category: 'focus' },
      { id: 'm5', task: 'ğŸ“ Write 3 things you\'re grateful for', points: 9, calm: 11, category: 'gratitude' },
      { id: 'm6', task: 'ğŸ® Play a relaxing game for 10 mins', points: 8, calm: 7, category: 'relaxation' },
      { id: 'm7', task: 'ğŸ¬ Watch a funny video', points: 5, calm: 6, category: 'joy' },
      { id: 'm8', task: 'ğŸ§  Practice a 5-minute meditation', points: 12, calm: 18, category: 'mindfulness' }
    ],
    social: [
      { id: 's1', task: 'ğŸ’¬ Text a friend something nice', points: 8, calm: 7, category: 'connection' },
      { id: 's2', task: 'ğŸ“ Call someone you care about', points: 12, calm: 10, category: 'connection' },
      { id: 's3', task: 'ğŸ¤— Give yourself a compliment', points: 6, calm: 8, category: 'self-love' },
      { id: 's4', task: 'â¤ï¸ Send a heart emoji to loved ones', points: 4, calm: 5, category: 'connection' },
      { id: 's5', task: 'ğŸ˜Š Smile at yourself in the mirror', points: 5, calm: 7, category: 'self-love' },
      { id: 's6', task: 'ğŸ Do something kind for someone', points: 10, calm: 12, category: 'kindness' },
      { id: 's7', task: 'ğŸŒŸ Share something positive online', points: 7, calm: 6, category: 'positivity' },
      { id: 's8', task: 'ğŸ‘¥ Plan a hangout with a friend', points: 9, calm: 8, category: 'connection' }
    ],
    environment: [
      { id: 'e1', task: 'ğŸ§¹ Clean your workspace for 5 mins', points: 8, calm: 10, category: 'organization' },
      { id: 'e2', task: 'ğŸŒ± Water a plant', points: 5, calm: 6, category: 'nature' },
      { id: 'e3', task: 'ğŸ•¯ï¸ Light a candle or incense', points: 4, calm: 8, category: 'ambiance' },
      { id: 'e4', task: 'ğŸªŸ Open a window for fresh air', points: 3, calm: 5, category: 'refresh' },
      { id: 'e5', task: 'ğŸ›ï¸ Make your bed', points: 6, calm: 7, category: 'organization' },
      { id: 'e6', task: 'ğŸ’¡ Adjust lighting to be cozy', points: 4, calm: 6, category: 'ambiance' },
      { id: 'e7', task: 'ğŸ§º Organize one small area', points: 7, calm: 9, category: 'organization' },
      { id: 'e8', task: 'ğŸŒ¸ Add something beautiful nearby', points: 5, calm: 7, category: 'aesthetics' }
    ],
    quick: [
      { id: 'q1', task: 'ğŸ˜®â€ğŸ’¨ Take 3 deep breaths', points: 3, calm: 5, category: 'breathing' },
      { id: 'q2', task: 'ğŸ‘€ Look away from screen (20-20-20 rule)', points: 2, calm: 3, category: 'eye-care' },
      { id: 'q3', task: 'ğŸ™Œ Do a quick shoulder roll', points: 3, calm: 4, category: 'movement' },
      { id: 'q4', task: 'ğŸ˜Œ Close your eyes for 30 seconds', points: 2, calm: 4, category: 'rest' },
      { id: 'q5', task: 'ğŸ¦¶ Stand up and wiggle your toes', points: 2, calm: 3, category: 'movement' },
      { id: 'q6', task: 'ğŸ’† Massage your temples', points: 4, calm: 6, category: 'tension-relief' },
      { id: 'q7', task: 'ğŸ«¶ Give yourself a hug', points: 3, calm: 5, category: 'self-love' },
      { id: 'q8', task: 'ğŸ˜ Say something nice to yourself', points: 4, calm: 6, category: 'self-love' }
    ]
  };
  
  // Particles
  const [particles, setParticles] = useState([]);
  
  // Breathing timer
  useEffect(() => {
    if (!breathingActive) return;
    
    const phases = [
      { name: 'inhale', duration: 4000 },
      { name: 'hold', duration: 4000 },
      { name: 'exhale', duration: 6000 },
      { name: 'hold', duration: 2000 }
    ];
    
    let currentPhaseIndex = 0;
    
    const cycleBreath = () => {
      const phase = phases[currentPhaseIndex];
      setBreathPhase(phase.name);
      
      setTimeout(() => {
        currentPhaseIndex = (currentPhaseIndex + 1) % phases.length;
        if (currentPhaseIndex === 0) {
          setBreathCount(prev => prev + 1);
        }
        cycleBreath();
      }, phase.duration);
    };
    
    cycleBreath();
  }, [breathingActive]);
  
  // Particle animation
  useEffect(() => {
    const interval = setInterval(() => {
      setParticles(prev => {
        const newParticles = [...prev.filter(p => p.life > 0).map(p => ({
          ...p,
          y: p.y - 1,
          life: p.life - 1
        }))];
        
        if (Math.random() > 0.7 && newParticles.length < 15) {
          newParticles.push({
            id: Math.random(),
            x: Math.random() * 100,
            y: 100,
            life: 100,
            particle: currentTheme.particle
          });
        }
        
        return newParticles;
      });
    }, 100);
    
    return () => clearInterval(interval);
  }, [currentTheme]);
  
  // Track time on dashboard and show personalized task recommendations - ENHANCED VERSION
  useEffect(() => {
    if (stage === 'dashboard' || stage === 'welcome') {
      const startTime = Date.now();
      
      const interval = setInterval(() => {
        // FIRST: Check sessionStorage immediately
        const hasShownInSession = sessionStorage.getItem('mindverse_recommendation_shown');
        if (hasShownInSession === 'true') {
          return; // Already shown - exit immediately
        }
        
        const timeSpent = Date.now() - startTime;
        const timeSinceLastInteraction = Date.now() - activityLog.lastInteractionTime;
        
        setActivityLog(prev => ({ ...prev, timeOnDashboard: timeSpent }));
        
        // STRICT CHECK: ONLY SHOW RECOMMENDATION ONCE PER LOGIN SESSION
        if (hasShownRecommendation || showTaskRecommendation || recommendedTask) {
          return; // Already shown or showing - exit immediately
        }
        
        console.log('ğŸ” Checking recommendation conditions:', {
          timeSpent,
          typingSpeed,
          showTaskRecommendation,
          hasShownRecommendation,
          recommendedTask: !!recommendedTask,
          sessionStorage: hasShownInSession
        });
        
        let shouldTrigger = false;
        let triggerReason = '';
        
        // Determine if we should trigger
        if (typingSpeed > 50) {
          shouldTrigger = true;
          triggerReason = 'URGENT STRESS';
        } else if (typingSpeed > 35 && timeSpent > 30000) {
          shouldTrigger = true;
          triggerReason = 'MODERATE STRESS';
        } else if (timeSinceLastInteraction > 120000) {
          shouldTrigger = true;
          triggerReason = 'IDLE';
        } else if (timeSpent > 20000) {
          shouldTrigger = true;
          triggerReason = 'INITIAL';
        }
        
        // Only proceed if we should trigger and haven't shown yet
        if (shouldTrigger && !hasShownRecommendation && !showTaskRecommendation && !recommendedTask) {
          console.log(`ğŸ¯ TRIGGERING: ${triggerReason} recommendation`);
          
          // Mark as shown IMMEDIATELY in both state and sessionStorage
          setHasShownRecommendation(true);
          sessionStorage.setItem('mindverse_recommendation_shown', 'true');
          console.log('ğŸ”’ Locked: Recommendation flag set - will not trigger again');
          
          const recommendation = getPersonalizedTaskRecommendation();
          if (recommendation) {
            if (recommendation instanceof Promise) {
              recommendation.then(result => {
                if (result) {
                  console.log('âœ… Showing recommendation:', result);
                  setRecommendedTask(result);
                  setShowTaskRecommendation(true);
                }
              }).catch(err => {
                console.error('âŒ Recommendation error:', err);
                // Do NOT reset flag - keep it locked to prevent retries
                console.log('âš ï¸ Error occurred but flag stays locked');
              });
            } else {
              console.log('âœ… Showing recommendation:', recommendation);
              setRecommendedTask(recommendation);
              setShowTaskRecommendation(true);
            }
          }
        }
      }, 3000); // Check every 3 seconds
      
      return () => clearInterval(interval);
    }
  }, [stage, showTaskRecommendation, recommendedTask, activityLog, completedTasks, typingSpeed, currentMood, hasShownRecommendation]);
  
  // Typing stress detection
  const handleTyping = () => {
    const now = Date.now();
    const timeDiff = now - lastKeyTime;
    
    // Update last interaction time
    setActivityLog(prev => ({ ...prev, lastInteractionTime: now }));
    
    if (timeDiff < 100) {
      setKeyPressCount(prev => prev + 1);
      if (keyPressCount > 10) {
        setTypingSpeed(prev => Math.min(prev + 5, 100));
        // Mark stress detected in activity log
        if (prev > 30) {
          setActivityLog(prevLog => ({ ...prevLog, stressDetected: true }));
        }
      }
    } else {
      setKeyPressCount(0);
      setTypingSpeed(prev => Math.max(prev - 1, 0));
    }
    
    setLastKeyTime(now);
  };
  
  // Handle mood selection
  const selectMood = (mood) => {
    setCurrentMood(mood);
    setCurrentTheme(weatherThemes[mood]);
    setMoodHistory(prev => [...prev, { mood, timestamp: new Date(), theme: weatherThemes[mood].name }]);
    setStage('dashboard');
    
    // Award points for checking in
    setEnergyPoints(prev => prev + 5);
    
    // Update last interaction time
    setActivityLog(prev => ({ ...prev, lastInteractionTime: Date.now() }));
    
    // Check if we should show a task recommendation based on mood (especially for negative moods)
    if (!showTaskRecommendation && !recommendedTask && (mood === 'anxious' || mood === 'stressed' || mood === 'sad')) {
      setTimeout(() => {
        const recommendation = getPersonalizedTaskRecommendation();
        if (recommendation) {
          if (recommendation instanceof Promise) {
            recommendation.then(result => {
              if (result) {
                setRecommendedTask(result);
                setShowTaskRecommendation(true);
              }
            });
          } else {
            setRecommendedTask(recommendation);
            setShowTaskRecommendation(true);
          }
        }
      }, 5000); // Show after 5 seconds of being on dashboard for negative moods
    }
  };
  
  // Start reset flow
  const startReset = () => {
    setStage('reset');
    setBreathingActive(true);
    setBreathCount(0);
    
    // Update last interaction time
    setActivityLog(prev => ({ ...prev, lastInteractionTime: Date.now() }));
  };
  
  // Complete reset activity
  const completeReset = () => {
    setBreathingActive(false);
    setEnergyPoints(prev => prev + 15);
    setCalmPoints(prev => prev + 20);
    setPlantLevel(prev => Math.min(prev + 0.2, 10));
    
    // Update activity log
    setActivityLog(prev => ({ 
      ...prev, 
      breathingCount: prev.breathingCount + 1,
      lastInteractionTime: Date.now()
    }));
    
    setStage('dashboard');
  };
  
  // Reframe thought with AI
  const reframeThought = async () => {
    if (!thoughtInput.trim()) return;
    
    setIsReframing(true);
    
    // Update last interaction time
    setActivityLog(prev => ({ ...prev, lastInteractionTime: Date.now() }));
    
    try {
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 1000,
          messages: [{
            role: 'user',
            content: `I'm having this thought: "${thoughtInput}"

Please give me a SHORT, empowering reframe of this thought. Keep it to just 1-2 sentences maximum. Be compassionate but concise. Make it feel like a supportive friend giving quick, helpful perspective.`
          }]
        })
      });
      
      const data = await response.json();
      const reframed = data.content[0].text;
      
      setReframedThought(reframed);
      setEnergyPoints(prev => prev + 10);
      setCalmPoints(prev => prev + 10);
      
      // Update activity log
      setActivityLog(prev => ({ 
        ...prev, 
        reframeCount: prev.reframeCount + 1,
        lastInteractionTime: Date.now()
      }));
      
    } catch (error) {
      setReframedThought("This feeling is temporary, and you're stronger than you think. ğŸ’™");
      setActivityLog(prev => ({ 
        ...prev, 
        reframeCount: prev.reframeCount + 1,
        lastInteractionTime: Date.now()
      }));
    } finally {
      setIsReframing(false);
    }
  };
  
  // Save journal entry
  const saveJournal = () => {
    if (!journalEntry.trim()) return;
    
    setJournalEntries(prev => [...prev, {
      text: journalEntry,
      timestamp: new Date(),
      mood: currentMood
    }]);
    
    setJournalEntry('');
    setEnergyPoints(prev => prev + 8);
    setCalmPoints(prev => prev + 12);
    
    // Update activity log
    setActivityLog(prev => ({ 
      ...prev, 
      journalCount: prev.journalCount + 1,
      lastInteractionTime: Date.now()
    }));
    
    setStage('dashboard');
  };
  
  // Send support to global community
  const sendSupport = (supportType) => {
    const support = supportMessages.find(s => s.id === supportType);
    setEnergyPoints(prev => prev + 3);
    setShowSupportModal(false);
    setSelectedSupport(null);
    
    // Update last interaction time
    setActivityLog(prev => ({ ...prev, lastInteractionTime: Date.now() }));
    
    // Show notification
    setSentSupportMessage(support);
    setShowSupportNotification(true);
    
    // Hide notification after 4 seconds
    setTimeout(() => {
      setShowSupportNotification(false);
      setTimeout(() => setSentSupportMessage(null), 300);
    }, 4000);
    
    // 30% chance to receive support back after 8-15 seconds
    if (Math.random() < 0.3) {
      const delay = Math.random() * 7000 + 8000; // 8-15 seconds
      setTimeout(() => {
        const randomSupport = supportMessages[Math.floor(Math.random() * supportMessages.length)];
        setReceivedSupportMessage(randomSupport);
        setShowReceivedSupport(true);
        
        // Hide after 5 seconds
        setTimeout(() => {
          setShowReceivedSupport(false);
          setTimeout(() => setReceivedSupportMessage(null), 300);
        }, 5000);
      }, delay);
    }
  };
  
  // Complete self-care task
  const completeTask = (taskId, task) => {
    if (completedTasks.includes(taskId)) {
      alert('âœ… You already completed this task today!');
      return;
    }
    
    const newCompletedTasks = [...completedTasks, taskId];
    setCompletedTasks(newCompletedTasks);
    setEnergyPoints(prev => prev + task.points);
    setCalmPoints(prev => prev + task.calm);
    setPlantLevel(prev => Math.min(prev + 0.1, 10));
    
    // Update activity log
    setActivityLog(prev => ({ 
      ...prev, 
      tasksCompleted: prev.tasksCompleted + 1,
      lastInteractionTime: Date.now()
    }));
    
    // Add to previous recommendations to avoid repeating immediately
    setPreviousRecommendations(prev => [...prev.slice(-4), taskId]); // Keep last 5
    
    alert(`ğŸ‰ Task completed! +${task.points} Energy, +${task.calm} Calm`);
  };
  
  // ğŸ¤– AI-POWERED: Analyze user activity and recommend personalized task with AI-generated message
  const getPersonalizedTaskRecommendation = async () => {
    const { breathingCount, reframeCount, journalCount, tasksCompleted, timeOnDashboard, stressDetected, lastInteractionTime } = activityLog;
    const totalActivity = breathingCount + reframeCount + journalCount + tasksCompleted;
    const timeSinceLastInteraction = Date.now() - lastInteractionTime;
    const taskCount = completedTasks.length;
    
    // Get all available tasks
    const allTasks = [
      ...selfCareTasks.physical,
      ...selfCareTasks.mental,
      ...selfCareTasks.social,
      ...selfCareTasks.environment,
      ...selfCareTasks.quick
    ].filter(task => 
      !completedTasks.includes(task.id) && 
      !previousRecommendations.includes(task.id) // Avoid recent recommendations
    );
    
    if (allTasks.length === 0) return null;
    
    let recommendedTask = null;
    
    // PRIORITY-BASED TASK SELECTION (same logic as before)
    // PRIORITY 0: MILESTONE CELEBRATIONS
    if (taskCount === 3) {
      const motivatingTasks = allTasks.filter(t => t.points + t.calm >= 10);
      if (motivatingTasks.length > 0) {
        recommendedTask = motivatingTasks[Math.floor(Math.random() * motivatingTasks.length)];
      }
    }
    else if (taskCount === 5) {
      const rewardTasks = allTasks.filter(t => 
        t.category === 'joy' || t.category === 'relaxation' || t.category === 'self-love' ||
        t.task.includes('favorite') || t.task.includes('enjoy')
      );
      if (rewardTasks.length > 0) {
        recommendedTask = rewardTasks[Math.floor(Math.random() * rewardTasks.length)];
      }
    }
    else if (taskCount === 10) {
      const celebratoryTasks = allTasks.filter(t => 
        t.category === 'connection' || t.category === 'kindness' || t.category === 'positivity' ||
        t.task.includes('friend') || t.task.includes('share')
      );
      if (celebratoryTasks.length > 0) {
        recommendedTask = celebratoryTasks[Math.floor(Math.random() * celebratoryTasks.length)];
      }
    }
    else if (taskCount === 15) {
      const highImpactTasks = allTasks.filter(t => (t.points + t.calm) >= 15).sort((a, b) => (b.points + b.calm) - (a.points + a.calm));
      if (highImpactTasks.length > 0) {
        recommendedTask = highImpactTasks[0];
      }
    }
    else if (taskCount >= 20) {
      const premiumTasks = allTasks
        .filter(t => (t.points + t.calm) >= 12)
        .sort((a, b) => {
          const scoreA = (a.points + a.calm) - Math.abs(a.points - a.calm);
          const scoreB = (b.points + b.calm) - Math.abs(b.points - b.calm);
          return scoreB - scoreA;
        });
      if (premiumTasks.length > 0) {
        recommendedTask = premiumTasks[0];
      }
    }
    
    // PRIORITY 1: URGENT STRESS
    if (!recommendedTask && typingSpeed > 50) {
      const urgentTasks = allTasks.filter(t => 
        t.category === 'breathing' || t.category === 'tension-relief' || t.category === 'eye-care' ||
        t.task.includes('cold water') || t.task.includes('close your eyes')
      );
      if (urgentTasks.length > 0) {
        recommendedTask = urgentTasks[Math.floor(Math.random() * urgentTasks.length)];
      }
    }
    
    // PRIORITY 2: MODERATE STRESS
    else if (!recommendedTask && (typingSpeed > 35 || stressDetected)) {
      const calmingTasks = allTasks.filter(t => 
        t.calm >= 6 && (t.category === 'breathing' || t.category === 'refresh' || 
        t.category === 'mindfulness' || t.task.includes('water') || t.task.includes('breathe'))
      );
      if (calmingTasks.length > 0) {
        recommendedTask = calmingTasks[Math.floor(Math.random() * calmingTasks.length)];
      }
    }
    
    // PRIORITY 3: MOOD-BASED
    else if (!recommendedTask && currentMood === 'anxious') {
      const anxietyTasks = allTasks.filter(t => 
        t.category === 'breathing' || t.category === 'mindfulness' || 
        t.category === 'movement' || t.task.includes('walk')
      );
      if (anxietyTasks.length > 0) {
        recommendedTask = anxietyTasks[Math.floor(Math.random() * anxietyTasks.length)];
      }
    }
    else if (!recommendedTask && currentMood === 'sad') {
      const upliftingTasks = allTasks.filter(t => 
        t.category === 'connection' || t.category === 'joy' || t.category === 'gratitude' ||
        t.task.includes('funny') || t.task.includes('friend')
      );
      if (upliftingTasks.length > 0) {
        recommendedTask = upliftingTasks[Math.floor(Math.random() * upliftingTasks.length)];
      }
    }
    else if (!recommendedTask && currentMood === 'tired') {
      const restTasks = allTasks.filter(t => 
        t.category === 'rest' || t.category === 'refresh' || t.category === 'hydration' ||
        t.task.includes('nap') || t.task.includes('water') || t.task.includes('eyes')
      );
      if (restTasks.length > 0) {
        recommendedTask = restTasks[Math.floor(Math.random() * restTasks.length)];
      }
    }
    else if (!recommendedTask && currentMood === 'stressed') {
      const stressReliefTasks = allTasks.filter(t => 
        t.calm >= 8 && (t.category === 'movement' || t.category === 'environment' || t.category === 'organization')
      );
      if (stressReliefTasks.length > 0) {
        recommendedTask = stressReliefTasks[Math.floor(Math.random() * stressReliefTasks.length)];
      }
    }
    
    // PRIORITY 4: IDLE USER
    else if (!recommendedTask && timeSinceLastInteraction > 120000) {
      const quickTasks = allTasks.filter(t => t.id.startsWith('q'));
      if (quickTasks.length > 0) {
        recommendedTask = quickTasks[Math.floor(Math.random() * quickTasks.length)];
      }
    }
    
    // PRIORITY 5: ACTIVITY BALANCE
    else if (!recommendedTask && reframeCount + journalCount >= 2 && breathingCount < 1) {
      const physicalTasks = allTasks.filter(t => 
        t.category === 'movement' || t.category === 'environment' ||
        t.task.includes('walk') || t.task.includes('stretch') || t.task.includes('fresh air')
      );
      if (physicalTasks.length > 0) {
        recommendedTask = physicalTasks[Math.floor(Math.random() * physicalTasks.length)];
      }
    }
    else if (!recommendedTask && breathingCount >= 1 && tasksCompleted === 0) {
      const environmentTasks = allTasks.filter(t => 
        t.category === 'environment' || t.category === 'organization' || t.category === 'ambiance'
      );
      if (environmentTasks.length > 0) {
        recommendedTask = environmentTasks[Math.floor(Math.random() * environmentTasks.length)];
      }
    }
    
    // PRIORITY 6: POINT OPTIMIZATION
    else if (!recommendedTask && energyPoints < 20 && totalActivity > 0) {
      const energyTasks = allTasks.filter(t => t.points >= 8).sort((a, b) => b.points - a.points);
      if (energyTasks.length > 0) {
        recommendedTask = energyTasks[Math.floor(Math.random() * Math.min(3, energyTasks.length))];
      }
    }
    else if (!recommendedTask && calmPoints < 20 && totalActivity > 0) {
      const calmTasks = allTasks.filter(t => t.calm >= 10).sort((a, b) => b.calm - a.calm);
      if (calmTasks.length > 0) {
        recommendedTask = calmTasks[Math.floor(Math.random() * Math.min(3, calmTasks.length))];
      }
    }
    
    // PRIORITY 7: SOCIAL CONNECTION
    else if (!recommendedTask && totalActivity >= 2 && !completedTasks.some(id => id.startsWith('s'))) {
      const socialTasks = allTasks.filter(t => t.category === 'connection' || t.category === 'kindness');
      if (socialTasks.length > 0) {
        recommendedTask = socialTasks[Math.floor(Math.random() * socialTasks.length)];
      }
    }
    
    // PRIORITY 8: SELF-LOVE CHECK
    else if (!recommendedTask && totalActivity >= 3) {
      const selfLoveTasks = allTasks.filter(t => t.category === 'self-love');
      if (selfLoveTasks.length > 0) {
        recommendedTask = selfLoveTasks[Math.floor(Math.random() * selfLoveTasks.length)];
      }
    }
    
    // PRIORITY 9: FIRST-TIME USER
    else if (!recommendedTask && totalActivity === 0 && timeOnDashboard > 60000) {
      const easyTasks = allTasks.filter(t => t.id.startsWith('q') || t.points <= 5);
      if (easyTasks.length > 0) {
        recommendedTask = easyTasks[Math.floor(Math.random() * easyTasks.length)];
      }
    }
    
    // PRIORITY 10: DEFAULT - BALANCED
    else if (!recommendedTask && totalActivity >= 1) {
      const balancedTasks = allTasks.filter(t => {
        const totalValue = t.points + t.calm;
        return totalValue >= 12 && Math.abs(t.points - t.calm) <= 5;
      });
      
      if (balancedTasks.length > 0) {
        recommendedTask = balancedTasks[Math.floor(Math.random() * balancedTasks.length)];
      } else {
        const highValueTasks = allTasks.filter(t => (t.points + t.calm) >= 12);
        if (highValueTasks.length > 0) {
          recommendedTask = highValueTasks[Math.floor(Math.random() * highValueTasks.length)];
        }
      }
    }
    
    // FALLBACK
    if (!recommendedTask && allTasks.length > 0) {
      recommendedTask = allTasks[Math.floor(Math.random() * allTasks.length)];
    }
    
    if (!recommendedTask) return null;
    
    // ğŸ¤– AI-POWERED PERSONALIZED MESSAGE GENERATION
    try {
      console.log('ğŸ¤– Generating AI-powered personalized recommendation message...');
      
      const response = await fetch('https://api.anthropic.com/v1/messages', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          model: 'claude-sonnet-4-20250514',
          max_tokens: 50,
          messages: [{
            role: 'user',
            content: `Task: "${recommendedTask.task}"

Write ONLY the task name. Nothing else. No explanations. Just: ${recommendedTask.task}`
          }]
        })
      });
      
      const data = await response.json();
      const aiReason = data.content[0].text.trim();
      
      console.log('âœ… AI-generated message:', aiReason);
      
      return { task: recommendedTask, reason: aiReason };
      
    } catch (error) {
      console.error('âŒ AI message generation failed, using fallback:', error);
      
      // Fallback - just return the task name
      return { task: recommendedTask, reason: recommendedTask.task };
    }
  };
  
  // Check if username is already taken by a different email
  const isUsernameTaken = (inputUsername, inputEmail) => {
    // Get all users from localStorage
    const usersKey = 'mindverse_users';
    const usersData = localStorage.getItem(usersKey);
    
    if (!usersData) {
      return false; // No users registered yet
    }
    
    try {
      const users = JSON.parse(usersData);
      
      // Check if username exists with a different email
      const existingUser = users.find(user => user.username === inputUsername);
      
      if (existingUser && existingUser.email !== inputEmail) {
        return true; // Username exists with different email
      }
      
      return false; // Username is available or matches the same email
    } catch (error) {
      console.error('Error checking username:', error);
      return false;
    }
  };
  
  // Save user to registry
  const saveUserToRegistry = (username, email) => {
    const usersKey = 'mindverse_users';
    const usersData = localStorage.getItem(usersKey);
    
    let users = [];
    
    if (usersData) {
      try {
        users = JSON.parse(usersData);
      } catch (error) {
        console.error('Error parsing users data:', error);
      }
    }
    
    // Check if user already exists (same username and email)
    const existingUserIndex = users.findIndex(
      user => user.username === username && user.email === email
    );
    
    if (existingUserIndex === -1) {
      // Add new user
      users.push({ username, email, createdAt: new Date().toISOString() });
      localStorage.setItem(usersKey, JSON.stringify(users));
    }
  };
  
  // Login
  const handleLogin = () => {
    if (loginInput.trim() && emailInput.trim()) {
      // Basic email validation
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(emailInput.trim())) {
        setLoginError('Please enter a valid email address');
        return;
      }
      
      // Check if username is taken by a different email
      if (isUsernameTaken(loginInput.trim(), emailInput.trim())) {
        setLoginError('This username is already taken. Please choose a different username or use the same email associated with this username.');
        return;
      }
      
      // Clear any previous errors
      setLoginError('');
      
      // Save user to registry
      saveUserToRegistry(loginInput.trim(), emailInput.trim());
      
      setUsername(loginInput.trim());
      setEmail(emailInput.trim());
      setIsLoggedIn(true);
      setStage('welcome');
    } else {
      setLoginError('Please enter both name and email');
    }
  };
  
  // Logout
  const handleLogout = () => {
    // Clear username and email from localStorage
    localStorage.removeItem('mindverse_username');
    localStorage.removeItem('mindverse_email');
    
    // Clear session storage for recommendations
    sessionStorage.removeItem('mindverse_current_session');
    sessionStorage.removeItem('mindverse_recommendation_shown');
    console.log('ğŸ”“ Session cleared - recommendations reset for next login');
    
    setIsLoggedIn(false);
    setUsername('');
    setEmail('');
    setLoginInput('');
    setEmailInput('');
    setLoginError('');
    setStage('welcome');
    setCurrentMood(null);
    setCurrentTheme(weatherThemes.calm);
    setMoodHistory([]);
    setEnergyPoints(0);
    setCalmPoints(0);
    setPlantLevel(1);
    setDailyStreak(0);
    setCompletedTasks([]);
    setJournalEntries([]);
    setJournalEntry('');
    setPreviousRecommendations([]);
    setHasShownRecommendation(false); // Reset recommendation flag on logout
    setShowTaskRecommendation(false); // Hide any showing recommendation
    setRecommendedTask(null); // Clear recommended task
  };
  
  // Calculate total level
  const totalPoints = energyPoints + calmPoints;
  const level = Math.floor(totalPoints / 50) + 1;
  
  // Plant growth stages
  const plantEmojis = ['ğŸŒ±', 'ğŸŒ¿', 'ğŸª´', 'ğŸŒ³', 'ğŸŒ²', 'ğŸ‹', 'ğŸŒ´', 'ğŸï¸', 'ğŸŒ¸', 'ğŸŒº'];
  const currentPlant = plantEmojis[Math.min(Math.floor(plantLevel) - 1, 9)];
  
  // Stress indicator component
  const StressIndicator = () => {
    if (typingSpeed < 30) return null;
    
    const stressLevel = typingSpeed > 50 ? 'high' : 'moderate';
    const bgColor = stressLevel === 'high' ? 'from-red-500/30 to-orange-500/30' : 'from-yellow-500/30 to-orange-500/30';
    const icon = stressLevel === 'high' ? 'ğŸš¨' : 'âš ï¸';
    const message = stressLevel === 'high' 
      ? 'High stress detected! Please take a break.' 
      : 'Elevated stress levels detected.';
    
    return (
      <div className={`bg-gradient-to-r ${bgColor} backdrop-blur-lg rounded-2xl p-4 mb-6 border-2 border-red-300/50 animate-pulse`}>
        <div className="flex items-center gap-3">
          <div className="text-3xl">{icon}</div>
          <div className="flex-1">
            <p className="text-white font-bold text-base">{message}</p>
            <p className="text-white/80 text-sm">Your typing patterns suggest you might need a moment to breathe.</p>
          </div>
          <div className="w-16 h-16 rounded-full bg-white/20 flex items-center justify-center">
            <div className="text-white font-black text-xl">{Math.round(typingSpeed)}</div>
          </div>
        </div>
      </div>
    );
  };
  
  // Login Screen
  if (!isLoggedIn) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 flex items-center justify-center p-6 relative overflow-hidden">
        {/* Animated background */}
        <div className="absolute inset-0 opacity-20">
          {[...Array(30)].map((_, i) => (
            <div
              key={i}
              className="absolute rounded-full bg-white"
              style={{
                left: `${Math.random() * 100}%`,
                top: `${Math.random() * 100}%`,
                width: `${Math.random() * 100 + 50}px`,
                height: `${Math.random() * 100 + 50}px`,
                animation: `float ${Math.random() * 10 + 10}s ease-in-out infinite`,
                animationDelay: `${Math.random() * 5}s`
              }}
            />
          ))}
        </div>
        
        <style>{`
          @keyframes float {
            0%, 100% { transform: translateY(0px) scale(1); }
            50% { transform: translateY(-30px) scale(1.1); }
          }
          @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
          }
          .animate-shake {
            animation: shake 0.5s ease-in-out;
          }
        `}</style>
        
        <div className="bg-white/95 backdrop-blur-xl rounded-3xl shadow-2xl p-12 max-w-md w-full relative z-10 border-4 border-white/50">
          <div className="text-center mb-8">
            <div className="text-7xl mb-4 animate-pulse">ğŸ§ </div>
            <h1 className="text-5xl font-black mb-3 bg-gradient-to-r from-indigo-600 to-pink-600 bg-clip-text text-transparent" style={{ fontFamily: 'Space Grotesk, sans-serif' }}>
              MindVerse
            </h1>
            <p className="text-gray-600 text-lg font-medium">Your Personal Mental Wellness Space</p>
          </div>
          
          <div className="space-y-4">
            {loginError && (
              <div className="bg-red-100 border-2 border-red-400 text-red-700 px-6 py-4 rounded-2xl animate-shake">
                <div className="flex items-center gap-3">
                  <span className="text-2xl">âš ï¸</span>
                  <p className="font-bold">{loginError}</p>
                </div>
              </div>
            )}
            
            <input
              type="text"
              placeholder="Enter your name"
              value={loginInput}
              onChange={(e) => {
                setLoginInput(e.target.value);
                setLoginError(''); // Clear error when user types
              }}
              onKeyPress={(e) => e.key === 'Enter' && document.getElementById('email-input').focus()}
              className="w-full px-6 py-4 rounded-2xl border-3 border-indigo-200 focus:border-indigo-500 focus:outline-none text-lg transition-all"
              style={{ fontFamily: 'Inter, sans-serif' }}
            />
            
            <input
              id="email-input"
              type="email"
              placeholder="Enter your email"
              value={emailInput}
              onChange={(e) => {
                setEmailInput(e.target.value);
                setLoginError(''); // Clear error when user types
              }}
              onKeyPress={(e) => e.key === 'Enter' && handleLogin()}
              className="w-full px-6 py-4 rounded-2xl border-3 border-indigo-200 focus:border-indigo-500 focus:outline-none text-lg transition-all"
              style={{ fontFamily: 'Inter, sans-serif' }}
            />
            
            <button
              onClick={handleLogin}
              className="w-full bg-gradient-to-r from-indigo-600 to-purple-600 text-white py-4 rounded-2xl font-bold text-lg hover:shadow-xl transition-all transform hover:scale-105"
            >
              Start Your Journey âœ¨
            </button>
          </div>
          
          <div className="mt-8 text-center text-sm text-gray-500 space-y-2">
            <p>âœ¨ Detect your stress in real-time</p>
            <p>ğŸŒˆ Experience dynamic mood environments</p>
            <p>ğŸ® Grow your wellness through gamification</p>
            <p>ğŸ¯ Get AI-powered personalized recommendations</p>
          </div>
        </div>
      </div>
    );
  }
  
  // Welcome / Mood Detection Screen
  if (stage === 'welcome') {
    return (
      <div className={`min-h-screen bg-gradient-to-br ${currentTheme.gradient} flex items-center justify-center p-6 relative overflow-hidden transition-all duration-1000`}>
        {/* Particles */}
        {particles.map(p => (
          <div
            key={p.id}
            className="absolute text-4xl pointer-events-none"
            style={{
              left: `${p.x}%`,
              bottom: `${p.y}%`,
              opacity: p.life / 100,
              transition: 'all 0.1s linear'
            }}
          >
            {p.particle}
          </div>
        ))}
        
        {/* Personalized Task Recommendation - SIMPLE ONE-LINE */}
        {showTaskRecommendation && recommendedTask && (
          <div className="fixed top-8 left-1/2 transform -translate-x-1/2 z-50 animate-fade-in">
            <div className="bg-white rounded-2xl shadow-2xl p-4 max-w-2xl border-4 border-purple-400">
              <div className="flex items-center gap-3">
                <div className="text-2xl">âœ¨</div>
                <p className="text-gray-900 font-bold text-lg flex-1">
                  {recommendedTask.reason}
                </p>
                <button
                  onClick={() => {
                    completeTask(recommendedTask.task.id, recommendedTask.task);
                    setShowTaskRecommendation(false);
                    setTimeout(() => setRecommendedTask(null), 300);
                    console.log('âœ… Task completed from recommendation');
                  }}
                  className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-2 rounded-xl font-bold transition-all"
                >
                  Try It! âœ¨
                </button>
                <button
                  onClick={() => {
                    setShowTaskRecommendation(false);
                    setTimeout(() => setRecommendedTask(null), 300);
                    console.log('âŒ Recommendation dismissed - will not show again this session');
                  }}
                  className="text-gray-400 hover:text-gray-600 transition-colors"
                >
                  <X size={24} />
                </button>
              </div>
            </div>
          </div>
        )}
        
        {/* Logout button - top right */}
        <button
          onClick={handleLogout}
          className="absolute top-8 right-8 z-20 flex items-center gap-2 bg-white/20 backdrop-blur-md hover:bg-white/30 text-white px-6 py-3 rounded-xl transition-all font-bold"
        >
          <LogOut size={20} />
          Logout
        </button>
        
        <div className="max-w-2xl w-full relative z-10">
          <div className="text-center mb-12">
            <div className="text-8xl mb-6 animate-bounce">ğŸ‘‹</div>
            <h1 className="text-6xl font-black text-white mb-4" style={{ fontFamily: 'Space Grotesk, sans-serif', textShadow: '2px 2px 20px rgba(0,0,0,0.3)' }}>
              Welcome back, {username}!
            </h1>
            <p className="text-2xl text-white/90 font-medium">How are you feeling today?</p>
          </div>
          
          {/* Stress Detection Bar */}
          <StressIndicator />
          
          {/* Mood Selection Grid */}
          <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-8">
            {Object.entries(weatherThemes).map(([mood, theme]) => {
              const Icon = theme.icon;
              return (
                <button
                  key={mood}
                  onClick={() => selectMood(mood)}
                  className="bg-white/20 backdrop-blur-xl hover:bg-white/30 rounded-3xl p-8 transition-all transform hover:scale-105 border-2 border-white/30 group"
                  style={{ fontFamily: 'Space Grotesk, sans-serif' }}
                >
                  <Icon className="mx-auto mb-3 text-white group-hover:scale-110 transition-transform" size={48} />
                  <p className="text-white font-bold text-xl capitalize">{mood}</p>
                  <p className="text-white/70 text-sm mt-1">{theme.name}</p>
                </button>
              );
            })}
          </div>
        </div>
      </div>
    );
  }
  
  // Main Dashboard
  if (stage === 'dashboard') {
    return (
      <div className={`min-h-screen bg-gradient-to-br ${currentTheme.gradient} p-6 relative overflow-hidden transition-all duration-1000`}>
        {/* Particles */}
        {particles.map(p => (
          <div
            key={p.id}
            className="absolute text-3xl pointer-events-none"
            style={{
              left: `${p.x}%`,
              bottom: `${p.y}%`,
              opacity: p.life / 100,
              transition: 'all 0.1s linear'
            }}
          >
            {p.particle}
          </div>
        ))}
        
        {/* Support Modal */}
        {showSupportModal && (
          <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-6">
            <div className="bg-white rounded-3xl p-8 max-w-2xl w-full relative animate-scale-in">
              <button
                onClick={() => setShowSupportModal(false)}
                className="absolute top-4 right-4 text-gray-400 hover:text-gray-600 transition-colors"
              >
                <X size={32} />
              </button>
              
              <h2 className="text-4xl font-black mb-3 bg-gradient-to-r from-pink-600 to-purple-600 bg-clip-text text-transparent" style={{ fontFamily: 'Space Grotesk, sans-serif' }}>
                Send Support
              </h2>
              <p className="text-gray-600 text-lg mb-8">Choose the message you'd like to send to the community</p>
              
              <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                {supportMessages.map(support => (
                  <button
                    key={support.id}
                    onClick={() => sendSupport(support.id)}
                    className={`bg-gradient-to-br ${support.color} hover:scale-105 rounded-2xl p-6 text-white transition-all transform group`}
                  >
                    <div className="text-5xl mb-3 group-hover:scale-110 transition-transform">{support.emoji}</div>
                    <h3 className="font-bold text-xl mb-2">{support.title}</h3>
                    <p className="text-white/90 text-sm">{support.message}</p>
                  </button>
                ))}
              </div>
            </div>
          </div>
        )}
        
        {/* Support Sent Notification */}
        {sentSupportMessage && (
          <div 
            className={`fixed top-8 right-8 z-50 transition-all duration-300 ${
              showSupportNotification ? 'translate-x-0 opacity-100' : 'translate-x-[120%] opacity-0'
            }`}
          >
            <div className={`bg-gradient-to-br ${sentSupportMessage.color} rounded-2xl shadow-2xl p-6 max-w-md border-4 border-white/50`}>
              <div className="flex items-start gap-4">
                <div className="text-5xl animate-bounce">{sentSupportMessage.emoji}</div>
                <div className="flex-1">
                  <h3 className="text-white font-black text-xl mb-1">Support Sent! âœ¨</h3>
                  <p className="text-white/90 text-sm mb-2">
                    Your {sentSupportMessage.title.toLowerCase()} has been sent to the community
                  </p>
                  <p className="text-white font-semibold text-sm italic">
                    "{sentSupportMessage.message}"
                  </p>
                  <div className="mt-3 flex items-center gap-2 text-white/80 text-xs">
                    <Zap size={14} className="text-yellow-300" />
                    <span>+3 Energy Points Earned</span>
                  </div>
                </div>
                <button
                  onClick={() => {
                    setShowSupportNotification(false);
                    setTimeout(() => setSentSupportMessage(null), 300);
                  }}
                  className="text-white/60 hover:text-white transition-colors"
                >
                  <X size={20} />
                </button>
              </div>
            </div>
          </div>
        )}
        
        {/* Received Support Notification */}
        {receivedSupportMessage && (
          <div 
            className={`fixed top-8 left-8 z-50 transition-all duration-300 ${
              showReceivedSupport ? 'translate-x-0 opacity-100' : 'translate-x-[-120%] opacity-0'
            }`}
          >
            <div className={`bg-gradient-to-br ${receivedSupportMessage.color} rounded-2xl shadow-2xl p-6 max-w-md border-4 border-white/50`}>
              <div className="flex items-start gap-4">
                <div className="text-5xl animate-bounce">{receivedSupportMessage.emoji}</div>
                <div className="flex-1">
                  <h3 className="text-white font-black text-xl mb-1">Support Received! ğŸ’</h3>
                  <p className="text-white/90 text-sm mb-2">
                    Someone from the community sent you {receivedSupportMessage.title.toLowerCase()}
                  </p>
                  <p className="text-white font-semibold text-sm italic">
                    "{receivedSupportMessage.message}"
                  </p>
                  <div className="mt-3 flex items-center gap-2 text-white/80 text-xs">
                    <Heart size={14} className="text-pink-300 animate-pulse" />
                    <span>You are not alone ğŸ’«</span>
                  </div>
                </div>
                <button
                  onClick={() => {
                    setShowReceivedSupport(false);
                    setTimeout(() => setReceivedSupportMessage(null), 300);
                  }}
                  className="text-white/60 hover:text-white transition-colors"
                >
                  <X size={20} />
                </button>
              </div>
            </div>
          </div>
        )}
        
        {/* Personalized Task Recommendation - SIMPLE ONE-LINE */}
        {showTaskRecommendation && recommendedTask && (
          <div className="fixed top-8 left-1/2 transform -translate-x-1/2 z-50 animate-fade-in">
            <div className="bg-white rounded-2xl shadow-2xl p-4 max-w-2xl border-4 border-purple-400">
              <div className="flex items-center gap-3">
                <div className="text-2xl">âœ¨</div>
                <p className="text-gray-900 font-bold text-lg flex-1">
                  {recommendedTask.reason}
                </p>
                <button
                  onClick={() => {
                    completeTask(recommendedTask.task.id, recommendedTask.task);
                    setShowTaskRecommendation(false);
                    setTimeout(() => setRecommendedTask(null), 300);
                    console.log('âœ… Task completed from recommendation');
                  }}
                  className="bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-700 hover:to-pink-700 text-white px-6 py-2 rounded-xl font-bold transition-all"
                >
                  Try It! âœ¨
                </button>
                <button
                  onClick={() => {
                    setShowTaskRecommendation(false);
                    setTimeout(() => setRecommendedTask(null), 300);
                    console.log('âŒ Recommendation dismissed - will not show again this session');
                  }}
                  className="text-gray-400 hover:text-gray-600 transition-colors"
                >
                  <X size={24} />
                </button>
              </div>
            </div>
          </div>
        )}
        
        <style>{`
          @keyframes scale-in {
            from {
              opacity: 0;
              transform: scale(0.9);
            }
            to {
              opacity: 1;
              transform: scale(1);
            }
          }
          @keyframes fade-in {
            from {
              opacity: 0;
              transform: translateY(20px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          .animate-scale-in {
            animation: scale-in 0.3s ease-out;
          }
          .animate-fade-in {
            animation: fade-in 0.5s ease-out;
          }
        `}</style>
        
        {/* Header */}
        <div className="max-w-7xl mx-auto relative z-10">
          <div className="flex justify-between items-center mb-8">
            <div className="flex items-center gap-4">
              <div className="text-5xl">{currentPlant}</div>
              <div>
                <h1 className="text-4xl font-black text-white" style={{ fontFamily: 'Space Grotesk, sans-serif', textShadow: '2px 2px 10px rgba(0,0,0,0.3)' }}>
                  {username}'s MindVerse
                </h1>
                <div className="flex gap-4 mt-2">
                  <span className="bg-white/20 backdrop-blur-md px-4 py-1 rounded-full text-white font-bold flex items-center gap-2">
                    <Zap size={16} className="text-yellow-300" />
                    {energyPoints} Energy
                  </span>
                  <span className="bg-white/20 backdrop-blur-md px-4 py-1 rounded-full text-white font-bold flex items-center gap-2">
                    <Leaf size={16} className="text-green-300" />
                    {calmPoints} Calm
                  </span>
                  <span className="bg-white/20 backdrop-blur-md px-4 py-1 rounded-full text-white font-bold flex items-center gap-2">
                    <Award size={16} className="text-purple-300" />
                    Level {level}
                  </span>
                </div>
              </div>
            </div>
            
            <div className="flex gap-3">
              <button
                onClick={() => setStage('welcome')}
                className="bg-white/20 backdrop-blur-md hover:bg-white/30 text-white px-4 py-3 rounded-xl transition-all flex items-center gap-2 font-bold"
                title="Change Mood"
              >
                â† Change Mood
              </button>
              <button
                onClick={handleLogout}
                className="bg-white/20 backdrop-blur-md hover:bg-white/30 text-white px-4 py-3 rounded-xl transition-all flex items-center gap-2 font-bold"
                title="Logout"
              >
                <LogOut size={24} />
                <span className="hidden md:inline">Logout</span>
              </button>
              <button
                onClick={() => {
                  const newState = !soundEnabled;
                  setSoundEnabled(newState);
                  console.log('Sound toggled:', newState);
                }}
                className="bg-white/20 backdrop-blur-md hover:bg-white/30 text-white p-3 rounded-xl transition-all"
                title={soundEnabled ? 'Mute ambient sound' : 'Play ambient sound'}
              >
                {soundEnabled ? <Volume2 size={24} /> : <VolumeX size={24} />}
              </button>
            </div>
          </div>
          
          {/* Stress Indicator */}
          <StressIndicator />
          
          {/* Current Weather Status */}
          <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 mb-8 border-2 border-white/30">
            <div className="flex items-center gap-6">
              <div className="text-8xl">{currentTheme.particle}</div>
              <div className="flex-1">
                <h2 className="text-4xl font-black text-white mb-2" style={{ fontFamily: 'Space Grotesk, sans-serif' }}>
                  {currentTheme.name} Weather
                </h2>
                <p className="text-xl text-white/90">You're feeling {currentMood} today</p>
                <p className="text-white/70 mt-2">Your mental weather reflects your inner state. Let's work together to brighten your sky.</p>
              </div>
            </div>
          </div>
          
          {/* Sound Selection */}
          <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-6 mb-8 border-2 border-white/30">
            <div className="flex items-center justify-between mb-4">
              <h3 className="text-2xl font-bold text-white flex items-center gap-2">
                ğŸµ Calming Music
              </h3>
              <div className="flex gap-3">
                <button
                  onClick={() => {
                    const newState = !soundEnabled;
                    setSoundEnabled(newState);
                    console.log('Music enabled:', newState);
                  }}
                  className={`px-6 py-3 rounded-xl font-bold transition-all ${
                    soundEnabled 
                      ? 'bg-green-500 text-white shadow-lg' 
                      : 'bg-white/30 text-white hover:bg-white/40'
                  }`}
                >
                  {soundEnabled ? 'ğŸµ Music ON (Playing)' : 'ğŸ”‡ Click to Enable Music'}
                </button>
              </div>
            </div>
            {soundEnabled && selectedSound !== 'silence' && (
              <div className="bg-gradient-to-r from-green-500/20 to-emerald-500/20 px-4 py-3 rounded-lg mb-4 border border-green-400/30">
                <p className="text-white font-bold text-sm flex items-center gap-2">
                  <span className="w-3 h-3 bg-green-400 rounded-full animate-pulse"></span>
                  Now playing: {musicTracks[selectedSound]?.name}
                </p>
                <p className="text-white/70 text-xs mt-1">
                  {musicTracks[selectedSound]?.description}
                </p>
              </div>
            )}
            {!soundEnabled && (
              <div className="bg-yellow-500/20 px-4 py-3 rounded-lg mb-4 border border-yellow-400/30">
                <p className="text-white text-sm">
                  ğŸ‘† Click "Enable Music" above, then select your calming soundtrack below
                </p>
              </div>
            )}
            <div className="grid grid-cols-4 md:grid-cols-8 gap-3">
              {soundOptions.map(sound => (
                <button
                  key={sound.id}
                  onClick={() => {
                    console.log('ğŸµ Sound option clicked:', sound.id);
                    
                    // Update selected sound first
                    setSelectedSound(sound.id);
                    
                    // Handle silence vs music
                    if (sound.id === 'silence') {
                      setSoundEnabled(false);
                      console.log('ğŸ”‡ Silence mode activated');
                    } else {
                      setSoundEnabled(true);
                      console.log('ğŸµ Music enabled:', sound.id);
                    }
                  }}
                  className={`p-4 rounded-2xl transition-all ${
                    selectedSound === sound.id
                      ? 'bg-white text-gray-900 scale-110 shadow-xl'
                      : 'bg-white/20 text-white hover:bg-white/30'
                  }`}
                  title={sound.name}
                >
                  <div className="text-3xl">{sound.emoji}</div>
                </button>
              ))}
            </div>
          </div>
          
          {/* Main Reset Button */}
          <div className="mb-8">
            <button
              onClick={startReset}
              className="w-full bg-gradient-to-r from-pink-500 to-purple-600 hover:from-pink-600 hover:to-purple-700 text-white py-8 rounded-3xl font-black text-4xl transition-all transform hover:scale-105 shadow-2xl"
              style={{ fontFamily: 'Space Grotesk, sans-serif' }}
            >
              âœ¨ RESET ME âœ¨
            </button>
          </div>
          
          {/* Action Cards */}
          <div className="grid md:grid-cols-3 gap-6 mb-8">
            <button
              onClick={() => setStage('reframe')}
              className="bg-white/20 backdrop-blur-xl hover:bg-white/30 rounded-3xl p-8 text-left transition-all transform hover:scale-105 border-2 border-white/30 group"
            >
              <Brain className="text-white mb-4 group-hover:scale-110 transition-transform" size={48} />
              <h3 className="text-2xl font-bold text-white mb-2">ğŸ’­ Mindset Shift</h3>
              <p className="text-white/80">Transform negative thoughts into empowering perspectives with AI guidance</p>
              <div className="mt-4 text-white/60 flex items-center gap-2">
                <Zap size={16} /> +10 Energy â€¢ <Leaf size={16} /> +10 Calm
              </div>
            </button>
            
            <button
              onClick={() => setStage('journal')}
              className="bg-white/20 backdrop-blur-xl hover:bg-white/30 rounded-3xl p-8 text-left transition-all transform hover:scale-105 border-2 border-white/30 group"
            >
              <div className="text-5xl mb-4 group-hover:scale-110 transition-transform">ğŸ“</div>
              <h3 className="text-2xl font-bold text-white mb-2">Journal Entry</h3>
              <p className="text-white/80">Express your thoughts and feelings in a safe space</p>
              <div className="mt-4 text-white/60 flex items-center gap-2">
                <Zap size={16} /> +8 Energy â€¢ <Leaf size={16} /> +12 Calm
              </div>
            </button>
            
            <button
              onClick={() => setStage('tasks')}
              className="bg-white/20 backdrop-blur-xl hover:bg-white/30 rounded-3xl p-8 text-left transition-all transform hover:scale-105 border-2 border-white/30 group"
            >
              <div className="text-5xl mb-4 group-hover:scale-110 transition-transform">âœ…</div>
              <h3 className="text-2xl font-bold text-white mb-2">Self-Care Tasks</h3>
              <p className="text-white/80">Quick activities to boost your wellbeing right now</p>
              <div className="mt-4 text-white/60 flex items-center gap-2">
                <Target size={16} /> {completedTasks.length} completed today
              </div>
            </button>
          </div>
          
          {/* Live Emotion Map */}
          <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30 mb-8">
            <h3 className="text-3xl font-bold text-white mb-6 flex items-center gap-3">
              ğŸ—ºï¸ Live Emotion Map
            </h3>
            <p className="text-white/90 text-lg mb-6">
              See how people around the world are feeling right now
            </p>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-4 mb-6">
              {Object.entries(globalMood).map(([mood, count]) => (
                <div key={mood} className="bg-white/10 rounded-2xl p-4">
                  <p className="text-white/70 text-sm capitalize mb-1">{mood}</p>
                  <p className="text-white font-bold text-2xl">{count} people</p>
                </div>
              ))}
            </div>
            <button
              onClick={() => setShowSupportModal(true)}
              className="w-full bg-gradient-to-r from-red-400 to-pink-500 hover:from-red-500 hover:to-pink-600 text-white py-4 rounded-2xl font-bold text-lg transition-all transform hover:scale-105 flex items-center justify-center gap-2"
            >
              <Heart size={24} />
              Send Support to Community
            </button>
          </div>
          
          {/* Mood History */}
          {moodHistory.length > 0 && (
            <div className="mt-8 bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30">
              <h3 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                <TrendingUp size={28} />
                Your Mood Journey
              </h3>
              <div className="space-y-3">
                {moodHistory.slice(-5).reverse().map((entry, idx) => (
                  <div key={idx} className="bg-white/10 rounded-xl p-4 flex items-center justify-between">
                    <div>
                      <p className="text-white font-bold capitalize">{entry.mood}</p>
                      <p className="text-white/60 text-sm">{entry.theme} Weather</p>
                    </div>
                    <p className="text-white/60 text-sm">{new Date(entry.timestamp).toLocaleTimeString()}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }
  
  // Reset Flow (Breathing + AI Support)
  if (stage === 'reset') {
    return (
      <div className={`min-h-screen bg-gradient-to-br ${currentTheme.gradient} flex items-center justify-center p-6 relative overflow-hidden transition-all duration-1000`}>
        <div className="max-w-2xl w-full relative z-10">
          <div className="text-center mb-12">
            <h1 className="text-5xl font-black text-white mb-4" style={{ fontFamily: 'Space Grotesk, sans-serif', textShadow: '2px 2px 10px rgba(0,0,0,0.3)' }}>
              Reset Protocol
            </h1>
            <p className="text-xl text-white/90">Let's recenter together</p>
          </div>
          
          {/* Breathing Circle */}
          <div className="mb-12">
            <div className="relative mx-auto" style={{ width: '300px', height: '300px' }}>
              <div
                className="absolute inset-0 rounded-full bg-white/30 backdrop-blur-xl transition-all duration-1000"
                style={{
                  transform: breathPhase === 'inhale' ? 'scale(1.4)' : breathPhase === 'exhale' ? 'scale(0.8)' : 'scale(1.1)',
                  boxShadow: '0 0 60px rgba(255,255,255,0.5)'
                }}
              />
              <div className="absolute inset-0 flex items-center justify-center">
                <div className="text-center">
                  <Wind className="mx-auto text-white mb-4" size={64} />
                  <p className="text-white text-3xl font-bold capitalize">{breathPhase}</p>
                  <p className="text-white/70 text-lg mt-2">Cycle {breathCount + 1}/3</p>
                </div>
              </div>
            </div>
          </div>
          
          {/* AI Support Messages */}
          <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 mb-8 border-2 border-white/30">
            <div className="flex items-start gap-4">
              <div className="text-4xl">ğŸ¤–</div>
              <div className="flex-1">
                <h3 className="text-xl font-bold text-white mb-3">AI Support</h3>
                {breathCount === 0 && (
                  <p className="text-white/90">You're doing great. Focus on your breath. Let everything else fade away for this moment.</p>
                )}
                {breathCount === 1 && (
                  <p className="text-white/90">Feel your body relaxing. Each breath brings you closer to calm. You're in control.</p>
                )}
                {breathCount >= 2 && (
                  <p className="text-white/90">Excellent work! You've completed the breathing exercise. Notice how you feel now compared to before. ğŸŒŸ</p>
                )}
              </div>
            </div>
          </div>
          
          {/* Tiny Task */}
          {breathCount >= 2 && (
            <div className="bg-green-500/20 backdrop-blur-xl rounded-3xl p-8 mb-8 border-2 border-green-300/50 animate-pulse">
              <div className="flex items-start gap-4">
                <Target className="text-green-300" size={40} />
                <div className="flex-1">
                  <h3 className="text-xl font-bold text-white mb-3">âœ… Tiny Task</h3>
                  <p className="text-white/90 mb-4">Great job! Here's a small task to maintain momentum:</p>
                  <p className="text-white font-bold text-lg bg-white/20 rounded-xl p-4">
                    ğŸ’§ Drink a glass of water
                  </p>
                </div>
              </div>
            </div>
          )}
          
          {/* Progress */}
          <div className="flex gap-4">
            {breathCount >= 3 ? (
              <button
                onClick={completeReset}
                className="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white py-6 rounded-2xl font-bold text-xl transition-all transform hover:scale-105"
              >
                Complete âœ¨ (+15 Energy, +20 Calm)
              </button>
            ) : (
              <button
                onClick={() => setStage('dashboard')}
                className="flex-1 bg-white/20 backdrop-blur-md hover:bg-white/30 text-white py-6 rounded-2xl font-bold text-xl transition-all"
              >
                Skip for now
              </button>
            )}
          </div>
        </div>
      </div>
    );
  }
  
  // Thought Reframer
  if (stage === 'reframe') {
    return (
      <div className={`min-h-screen bg-gradient-to-br ${currentTheme.gradient} p-6 relative overflow-hidden transition-all duration-1000`}>
        <div className="max-w-3xl mx-auto relative z-10 py-12">
          <button
            onClick={() => setStage('dashboard')}
            className="mb-6 text-white/80 hover:text-white transition-colors flex items-center gap-2"
          >
            â† Back to Dashboard
          </button>
          
          <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30 mb-8">
            <h2 className="text-4xl font-black text-white mb-4" style={{ fontFamily: 'Space Grotesk, sans-serif' }}>
              ğŸ’­ Mindset Shift
            </h2>
            <p className="text-white/90 text-lg mb-6">
              Share a challenging thought, and get a quick, powerful perspective shift in seconds.
            </p>
            
            <textarea
              value={thoughtInput}
              onChange={(e) => setThoughtInput(e.target.value)}
              onKeyDown={handleTyping}
              placeholder="What's weighing on you? (e.g., 'I'm not good enough...', 'Everything always goes wrong...')"
              className="w-full h-32 p-6 rounded-2xl border-2 border-white/30 bg-white/10 text-white placeholder-white/50 focus:outline-none focus:border-white/60 transition-all resize-none text-lg"
              style={{ fontFamily: 'Inter, sans-serif' }}
            />
            
            <button
              onClick={reframeThought}
              disabled={isReframing || !thoughtInput.trim()}
              className="w-full mt-4 bg-gradient-to-r from-purple-500 to-pink-600 hover:from-purple-600 hover:to-pink-700 disabled:from-gray-500 disabled:to-gray-600 text-white py-5 rounded-2xl font-bold text-xl transition-all transform hover:scale-105 disabled:scale-100"
            >
              {isReframing ? 'Shifting Your Perspective... ğŸ¤”' : 'Shift My Mindset âœ¨'}
            </button>
          </div>
          
          {reframedThought && (
            <div className="bg-gradient-to-br from-green-500/30 to-blue-500/30 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/40 animate-fade-in">
              <div className="text-center">
                <div className="text-6xl mb-6 animate-bounce">ğŸ’­</div>
                <h3 className="text-3xl font-bold text-white mb-6">Your New Perspective:</h3>
                <p className="text-white text-2xl font-semibold leading-relaxed mb-8">{reframedThought}</p>
                
                <div className="flex gap-3 justify-center">
                  <button
                    onClick={() => {
                      setThoughtInput('');
                      setReframedThought('');
                    }}
                    className="bg-white/20 hover:bg-white/30 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all"
                  >
                    Shift Another Thought
                  </button>
                  <button
                    onClick={() => {
                      setStage('dashboard');
                      setThoughtInput('');
                      setReframedThought('');
                    }}
                    className="bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700 text-white px-8 py-4 rounded-xl font-bold text-lg transition-all"
                  >
                    Done (+10 Energy, +10 Calm)
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }
  
  // Journal
  if (stage === 'journal') {
    return (
      <div className={`min-h-screen bg-gradient-to-br ${currentTheme.gradient} p-6 relative overflow-hidden transition-all duration-1000`}>
        <div className="max-w-3xl mx-auto relative z-10 py-12">
          <button
            onClick={() => setStage('dashboard')}
            className="mb-6 text-white/80 hover:text-white transition-colors flex items-center gap-2"
          >
            â† Back to Dashboard
          </button>
          
          <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30 mb-8">
            <h2 className="text-4xl font-black text-white mb-4" style={{ fontFamily: 'Space Grotesk, sans-serif' }}>
              ğŸ“ Journal Entry
            </h2>
            <p className="text-white/90 text-lg mb-6">
              Express yourself freely. This is your safe space.
            </p>
            
            <textarea
              value={journalEntry}
              onChange={(e) => setJournalEntry(e.target.value)}
              onKeyDown={handleTyping}
              placeholder="How was your day? What are you grateful for? What's challenging you?"
              className="w-full h-64 p-6 rounded-2xl border-2 border-white/30 bg-white/10 text-white placeholder-white/50 focus:outline-none focus:border-white/60 transition-all resize-none text-lg"
              style={{ fontFamily: 'Inter, sans-serif' }}
            />
            
            <div className="flex gap-3 mt-4">
              <button
                onClick={saveJournal}
                disabled={!journalEntry.trim()}
                className="flex-1 bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 disabled:from-gray-500 disabled:to-gray-600 text-white py-5 rounded-2xl font-bold text-xl transition-all transform hover:scale-105 disabled:scale-100"
              >
                Save Entry âœ¨ (+8 Energy, +12 Calm)
              </button>
            </div>
          </div>
          
          {/* Previous Entries */}
          {journalEntries.length > 0 && (
            <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30">
              <h3 className="text-2xl font-bold text-white mb-6">Your Journal Entries ({journalEntries.length})</h3>
              <div className="space-y-4 max-h-96 overflow-y-auto">
                {journalEntries.slice().reverse().map((entry, idx) => (
                  <div key={idx} className="bg-white/10 rounded-2xl p-6 hover:bg-white/15 transition-all">
                    <div className="flex items-center justify-between mb-3">
                      <span className="text-white/70 capitalize flex items-center gap-2">
                        <span className="text-xl">
                          {entry.mood === 'anxious' && 'ğŸŒ§ï¸'}
                          {entry.mood === 'stressed' && 'â˜ï¸'}
                          {entry.mood === 'sad' && 'ğŸ’§'}
                          {entry.mood === 'calm' && 'âœ¨'}
                          {entry.mood === 'happy' && 'â˜€ï¸'}
                          {entry.mood === 'tired' && 'ğŸŒ™'}
                        </span>
                        Feeling: {entry.mood}
                      </span>
                      <span className="text-white/50 text-sm">
                        {new Date(entry.timestamp).toLocaleDateString('en-US', { 
                          month: 'short', 
                          day: 'numeric', 
                          year: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}
                      </span>
                    </div>
                    <p className="text-white leading-relaxed whitespace-pre-wrap">{entry.text}</p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>
    );
  }
  
  // Self-Care Tasks Screen
  if (stage === 'tasks') {
    return (
      <div className={`min-h-screen bg-gradient-to-br ${currentTheme.gradient} p-6 relative overflow-hidden transition-all duration-1000`}>
        <div className="max-w-6xl mx-auto relative z-10 py-12">
          <button
            onClick={() => setStage('dashboard')}
            className="mb-6 text-white/80 hover:text-white transition-colors flex items-center gap-2"
          >
            â† Back to Dashboard
          </button>
          
          <div className="text-center mb-12">
            <h1 className="text-5xl font-black text-white mb-4" style={{ fontFamily: 'Space Grotesk, sans-serif', textShadow: '2px 2px 10px rgba(0,0,0,0.3)' }}>
              âœ… Self-Care Tasks
            </h1>
            <p className="text-2xl text-white/90">Quick activities to boost your wellbeing</p>
            <div className="mt-4 inline-flex gap-4 bg-white/20 backdrop-blur-md px-8 py-3 rounded-full">
              <span className="text-white font-bold">{completedTasks.length} tasks completed today ğŸ‰</span>
            </div>
          </div>
          
          {/* Quick Tasks - Always visible */}
          <div className="bg-gradient-to-br from-yellow-400/30 to-orange-500/30 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/40 mb-8">
            <h2 className="text-3xl font-bold text-white mb-2 flex items-center gap-3">
              âš¡ Quick Wins (30 seconds)
            </h2>
            <p className="text-white/80 mb-6">Perfect for right now - instant mood boost!</p>
            <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
              {selfCareTasks.quick.map(task => (
                <button
                  key={task.id}
                  onClick={() => completeTask(task.id, task)}
                  disabled={completedTasks.includes(task.id)}
                  className={`p-6 rounded-2xl text-left transition-all transform hover:scale-105 ${
                    completedTasks.includes(task.id)
                      ? 'bg-green-500/40 border-2 border-green-300'
                      : 'bg-white/20 hover:bg-white/30 border-2 border-white/30'
                  }`}
                >
                  <p className="text-white font-bold text-lg mb-3">{task.task}</p>
                  <div className="flex items-center gap-3 text-white/70 text-sm">
                    <span className="flex items-center gap-1">
                      <Zap size={14} /> +{task.points}
                    </span>
                    <span className="flex items-center gap-1">
                      <Leaf size={14} /> +{task.calm}
                    </span>
                  </div>
                  {completedTasks.includes(task.id) && (
                    <div className="mt-3 text-green-300 font-bold text-sm">âœ“ Completed!</div>
                  )}
                </button>
              ))}
            </div>
          </div>
          
          {/* Task Categories Grid */}
          <div className="grid md:grid-cols-2 gap-8">
            {/* Physical Tasks */}
            <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30">
              <h3 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                ğŸ’ª Physical Care
              </h3>
              <div className="space-y-3">
                {selfCareTasks.physical.map(task => (
                  <button
                    key={task.id}
                    onClick={() => completeTask(task.id, task)}
                    disabled={completedTasks.includes(task.id)}
                    className={`w-full p-5 rounded-xl text-left transition-all transform hover:scale-102 ${
                      completedTasks.includes(task.id)
                        ? 'bg-green-500/40 border-2 border-green-300'
                        : 'bg-white/10 hover:bg-white/20 border-2 border-white/20'
                    }`}
                  >
                    <div className="flex items-center justify-between">
                      <p className="text-white font-bold flex-1">{task.task}</p>
                      <div className="flex items-center gap-2 text-white/70 text-sm">
                        <span className="flex items-center gap-1">
                          <Zap size={14} /> {task.points}
                        </span>
                        <span className="flex items-center gap-1">
                          <Leaf size={14} /> {task.calm}
                        </span>
                      </div>
                    </div>
                    {completedTasks.includes(task.id) && (
                      <div className="mt-2 text-green-300 font-bold text-sm">âœ“ Done</div>
                    )}
                  </button>
                ))}
              </div>
            </div>
            
            {/* Mental Tasks */}
            <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30">
              <h3 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                ğŸ§  Mental Care
              </h3>
              <div className="space-y-3">
                {selfCareTasks.mental.map(task => (
                  <button
                    key={task.id}
                    onClick={() => completeTask(task.id, task)}
                    disabled={completedTasks.includes(task.id)}
                    className={`w-full p-5 rounded-xl text-left transition-all transform hover:scale-102 ${
                      completedTasks.includes(task.id)
                        ? 'bg-green-500/40 border-2 border-green-300'
                        : 'bg-white/10 hover:bg-white/20 border-2 border-white/20'
                    }`}
                  >
                    <div className="flex items-center justify-between">
                      <p className="text-white font-bold flex-1">{task.task}</p>
                      <div className="flex items-center gap-2 text-white/70 text-sm">
                        <span className="flex items-center gap-1">
                          <Zap size={14} /> {task.points}
                        </span>
                        <span className="flex items-center gap-1">
                          <Leaf size={14} /> {task.calm}
                        </span>
                      </div>
                    </div>
                    {completedTasks.includes(task.id) && (
                      <div className="mt-2 text-green-300 font-bold text-sm">âœ“ Done</div>
                    )}
                  </button>
                ))}
              </div>
            </div>
            
            {/* Social Tasks */}
            <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30">
              <h3 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                ğŸ’– Social Connection
              </h3>
              <div className="space-y-3">
                {selfCareTasks.social.map(task => (
                  <button
                    key={task.id}
                    onClick={() => completeTask(task.id, task)}
                    disabled={completedTasks.includes(task.id)}
                    className={`w-full p-5 rounded-xl text-left transition-all transform hover:scale-102 ${
                      completedTasks.includes(task.id)
                        ? 'bg-green-500/40 border-2 border-green-300'
                        : 'bg-white/10 hover:bg-white/20 border-2 border-white/20'
                    }`}
                  >
                    <div className="flex items-center justify-between">
                      <p className="text-white font-bold flex-1">{task.task}</p>
                      <div className="flex items-center gap-2 text-white/70 text-sm">
                        <span className="flex items-center gap-1">
                          <Zap size={14} /> {task.points}
                        </span>
                        <span className="flex items-center gap-1">
                          <Leaf size={14} /> {task.calm}
                        </span>
                      </div>
                    </div>
                    {completedTasks.includes(task.id) && (
                      <div className="mt-2 text-green-300 font-bold text-sm">âœ“ Done</div>
                    )}
                  </button>
                ))}
              </div>
            </div>
            
            {/* Environment Tasks */}
            <div className="bg-white/20 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/30">
              <h3 className="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                ğŸŒ¿ Environment
              </h3>
              <div className="space-y-3">
                {selfCareTasks.environment.map(task => (
                  <button
                    key={task.id}
                    onClick={() => completeTask(task.id, task)}
                    disabled={completedTasks.includes(task.id)}
                    className={`w-full p-5 rounded-xl text-left transition-all transform hover:scale-102 ${
                      completedTasks.includes(task.id)
                        ? 'bg-green-500/40 border-2 border-green-300'
                        : 'bg-white/10 hover:bg-white/20 border-2 border-white/20'
                    }`}
                  >
                    <div className="flex items-center justify-between">
                      <p className="text-white font-bold flex-1">{task.task}</p>
                      <div className="flex items-center gap-2 text-white/70 text-sm">
                        <span className="flex items-center gap-1">
                          <Zap size={14} /> {task.points}
                        </span>
                        <span className="flex items-center gap-1">
                          <Leaf size={14} /> {task.calm}
                        </span>
                      </div>
                    </div>
                    {completedTasks.includes(task.id) && (
                      <div className="mt-2 text-green-300 font-bold text-sm">âœ“ Done</div>
                    )}
                  </button>
                ))}
              </div>
            </div>
          </div>
          
          {/* Progress Summary */}
          <div className="mt-8 bg-gradient-to-br from-purple-500/30 to-pink-500/30 backdrop-blur-xl rounded-3xl p-8 border-2 border-white/40 text-center">
            <h3 className="text-3xl font-bold text-white mb-4">Today's Progress ğŸ¯</h3>
            <div className="grid grid-cols-2 md:grid-cols-4 gap-6">
              <div>
                <p className="text-white/70 text-sm mb-2">Total Completed</p>
                <p className="text-white font-black text-4xl">{completedTasks.length}</p>
              </div>
              <div>
                <p className="text-white/70 text-sm mb-2">Quick Wins</p>
                <p className="text-white font-black text-4xl">
                  {completedTasks.filter(id => id.startsWith('q')).length}
                </p>
              </div>
              <div>
                <p className="text-white/70 text-sm mb-2">Energy Earned</p>
                <p className="text-white font-black text-4xl flex items-center justify-center gap-2">
                  <Zap size={32} className="text-yellow-300" />
                  {energyPoints}
                </p>
              </div>
              <div>
                <p className="text-white/70 text-sm mb-2">Calm Earned</p>
                <p className="text-white font-black text-4xl flex items-center justify-center gap-2">
                  <Leaf size={32} className="text-green-300" />
                  {calmPoints}
                </p>
              </div>
            </div>
            <p className="text-white/90 text-lg mt-6">
              {completedTasks.length === 0 && "Start with a quick win to build momentum! ğŸ’ª"}
              {completedTasks.length > 0 && completedTasks.length < 5 && "Great start! Keep going! ğŸŒŸ"}
              {completedTasks.length >= 5 && completedTasks.length < 10 && "You're on fire! Amazing progress! ğŸ”¥"}
              {completedTasks.length >= 10 && "Incredible dedication! You're a self-care champion! ğŸ†"}
            </p>
          </div>
        </div>
      </div>
    );
  }
  
  return null;
}